Bluepill.application("maileed") do |app|

  app.uid, app.gid = "<%= node['maileed']['uid'] %>", "<%= node['maileed']['gid'] %>"
  app.working_dir = "<%= node['maileed']['deploy_dir'] %>"

  <%= node['maileed']['total_senders'] %>.times do |i|
    app.process("sender#{i}") do |process|
      process.start_command = "python src/sender_instance.py"
      process.pid_file = "<%= node['maileed']['pid_dir'] %>/sender#{i}.pid"
      process.start_grace_time = 4.seconds
      process.daemonize = true
      process.group = "senders"
    end
  end

  app.process("master") do |process|
    process.start_command = "python src/maileed.py"
    process.pid_file = "<%= node['maileed']['pid_dir'] %>/master.pid"
    process.start_grace_time = 4.seconds
    process.daemonize = true
  end
end
